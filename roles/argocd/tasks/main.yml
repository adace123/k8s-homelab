- name: Install ArgoCD
  community.kubernetes.helm:
    name: argo-cd
    chart_ref: argo/argo-cd
    release_namespace: argo-cd
    wait: yes
    atomic: yes
    wait_timeout: 5m
    values:
      server:
        extraArgs:
          - --insecure
        ingress:
          enabled: true
          annotations:
            kubernetes.io/ingress.class: traefik
            cert-manager.io/cluster-issuer: cluster-cert-issuer
          hosts:
            - "argocd.{{ k8s_base_domain }}"
          tls:
            - secretName: argocd-tls
              hosts:
                - "argocd.{{ k8s_base_domain }}"
  register: argocd
